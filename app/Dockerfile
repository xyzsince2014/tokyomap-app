FROM node:16

LABEL maintainer="xyzsince2014 <xyzsince2014@gmail.com>"

RUN mkdir /src
COPY . /src

ARG NODE_ENV
ARG DB_HOST
ARG DB_DATABASE
ARG DB_USER
ARG DB_PASSWORD
ARG DB_PORT
ARG SESSION_KEY
ARG SESSION_SECRETE
ARG TWITTER_CONSUMER_KEY
ARG TWITTER_CONSUMER_SECRET
ARG FACEBOOK_APP_ID
ARG FACEBOOK_APP_SECRET
ARG LINE_CHANNEL_ID
ARG LINE_CHANNEL_SECRET
ARG REDIS_HOST
ARG REDIS_PORT
ARG DOMAIN
ARG PORT
ARG ERROR_URI
ARG AUTH_CONTAINER
ARG RESOURCE_CONTAINER
ARG CLIENT_ID
ARG CLIENT_SECRET
ARG REGISTRATION_ACCESS_TOKEN
ARG REGISTRATION_CLIENT_URI

ENV NODE_ENV=${NODE_ENV}
ENV DB_HOST=${DB_HOST}
ENV DB_DATABASE=${DB_DATABASE}
ENV DB_USER=${DB_USER}
ENV DB_PASSWORD=${DB_PASSWORD}
ENV DB_PORT=${DB_PORT}
ENV SESSION_KEY=${SESSION_KEY}
ENV SESSION_SECRETE=${SESSION_SECRETE}
ENV TWITTER_CONSUMER_KEY=${TWITTER_CONSUMER_KEY}
ENV TWITTER_CONSUMER_SECRET=${TWITTER_CONSUMER_SECRET}
ENV FACEBOOK_APP_ID=${FACEBOOK_APP_ID}
ENV FACEBOOK_APP_SECRET=${FACEBOOK_APP_SECRET}
ENV LINE_CHANNEL_ID=${LINE_CHANNEL_ID}
ENV LINE_CHANNEL_SECRET=${LINE_CHANNEL_SECRET}
ENV REDIS_HOST=${REDIS_HOST}
ENV REDIS_PORT=${REDIS_PORT}
ENV DOMAIN=${DOMAIN}
ENV PORT=${PORT}
ENV ERROR_URI=${ERROR_URI}
ENV AUTH_CONTAINER=${AUTH_CONTAINER}
ENV RESOURCE_CONTAINER=${RESOURCE_CONTAINER}
ENV CLIENT_ID=${CLIENT_ID}
ENV CLIENT_SECRET=${CLIENT_SECRET}
ENV REGISTRATION_ACCESS_TOKEN=${REGISTRATION_ACCESS_TOKEN}
ENV REGISTRATION_CLIENT_URI=${REGISTRATION_CLIENT_URI}

WORKDIR /src

RUN yarn install --production

ENTRYPOINT [ "yarn", "start" ]
